CREATE DATABASE AirportBD;
USE AirportBD;

SET lc_time_names = 'en_US';

SET FOREIGN_KEY_CHECKS = 0;

DROP TABLE IF EXISTS AIRPORT;
DROP TABLE IF EXISTS FLIGHT;
DROP TABLE IF EXISTS FLIGHT_LEG_INSTANCE;
DROP TABLE IF EXISTS FARE;
DROP TABLE IF EXISTS SEAT_RESERVATION;

SET FOREIGN_KEY_CHECKS = 1;

CREATE TABLE AIRPORT(
    AIRPORT_CODE VARCHAR(3),   
    AIRPORT_NAME VARCHAR(15),  
    CITY VARCHAR(10),  
    STATE VARCHAR(10),
    PRIMARY KEY (AIRPORT_CODE)
);

CREATE TABLE FLIGHT(
    FLIGHT_NUMBER INT,
    AIRLINE VARCHAR(10),   
    WEEKDAYS VARCHAR(10),
    DEPARTURE_AIRPORT_CODE VARCHAR(3),
    ARRIVAL_AIRPORT_CODE VARCHAR(3),
    PRIMARY KEY (FLIGHT_NUMBER),
    FOREIGN KEY (DEPARTURE_AIRPORT_CODE) REFERENCES AIRPORT(AIRPORT_CODE),
    FOREIGN KEY (ARRIVAL_AIRPORT_CODE) REFERENCES AIRPORT(AIRPORT_CODE)
);

CREATE TABLE FLIGHT_LEG_INSTANCE(
    FLIGHT_NUMBER INT,
    LEG_NUMBER INT,
    LEG_DATE DATE,
    NUMBER_OF_AVAILABLE_SEATS INT,
    AIRPLANE_ID INT,
    DEPARTURE_TIME DATETIME,
    ARRIVAL_TIME DATETIME,
    PRIMARY KEY (FLIGHT_NUMBER, LEG_NUMBER, LEG_DATE),
    FOREIGN KEY (FLIGHT_NUMBER) REFERENCES FLIGHT(FLIGHT_NUMBER)
);

CREATE TABLE FARE(
    FLIGHT_NUMBER INT,
    FARE_CODE VARCHAR(1),
    AMOUNT DECIMAL(10,2),
    RESTRICTIONS VARCHAR(3),
    PRIMARY KEY (FLIGHT_NUMBER, FARE_CODE),
    FOREIGN KEY (FLIGHT_NUMBER) REFERENCES FLIGHT(FLIGHT_NUMBER)
);

CREATE TABLE SEAT_RESERVATION(
    FLIGHT_NUMBER INT,  
    LEG_NUMBER INT,
    LEG_DATE DATE,
    SEAT_NUMBER VARCHAR(4),
    CUSTOMER_NAME VARCHAR(18),
    CUSTOMER_PHONE VARCHAR(12),
    PRIMARY KEY (FLIGHT_NUMBER, LEG_NUMBER, LEG_DATE, SEAT_NUMBER),
    FOREIGN KEY (FLIGHT_NUMBER, LEG_NUMBER, LEG_DATE) REFERENCES FLIGHT_LEG_INSTANCE(FLIGHT_NUMBER, LEG_NUMBER, LEG_DATE)
);

-- Populate AIRPORT table
INSERT INTO AIRPORT VALUES ('MEX','MEXICO CITY','MEXICO','MEXICO');
INSERT INTO AIRPORT VALUES ('MTY','MONTERREY','MEXICO','MEXICO');
INSERT INTO AIRPORT VALUES ('JFK','NEW YORK','NEW YORK','USA');
INSERT INTO AIRPORT VALUES ('YYZ','TORONTO','ONTARIO','CANADA');
INSERT INTO AIRPORT VALUES ('YHU','MONTREAL','QUEBEC','CANADA');

-- Populate FLIGHT table
INSERT INTO FLIGHT VALUES (1001,'AEROMEXICO','MONDAY','MEX','MTY');
INSERT INTO FLIGHT VALUES (1002,'AEROMEXICO','TUESDAY','MTY','JFK');
INSERT INTO FLIGHT VALUES (1003,'VOLARIS','WEDNESDAY','MEX','MTY');
INSERT INTO FLIGHT VALUES (1004,'VOLARIS','THURSDAY','MTY','JFK');
INSERT INTO FLIGHT VALUES (1005,'DELTA','FRIDAY','JFK','MTY');

-- Populate FLIGHT_LEG_INSTANCE table
INSERT INTO FLIGHT_LEG_INSTANCE VALUES (1001, 1, '2023-09-20', 100, 12345, '2023-09-20 08:00:00', '2023-09-20 09:00:00');
INSERT INTO FLIGHT_LEG_INSTANCE VALUES (1002, 1, '2023-09-20', 200, 12346, '2023-09-20 10:00:00', '2023-09-20 13:00:00');
INSERT INTO FLIGHT_LEG_INSTANCE VALUES (1003, 1, '2023-09-20', 150, 12329, '2023-09-20 08:00:00', '2023-09-20 09:00:00');
INSERT INTO FLIGHT_LEG_INSTANCE VALUES (1004, 1, '2023-09-20', 180, 22123, '2023-09-20 10:00:00', '2023-09-20 13:00:00');
INSERT INTO FLIGHT_LEG_INSTANCE VALUES (1005, 1, '2023-09-20', 120, 9871, '2023-09-20 08:00:00', '2023-09-20 09:00:00');

-- Populate FARE table
INSERT INTO FARE VALUES (1001,'A',1000,'NOR');
INSERT INTO FARE VALUES (1002,'B',2000,'NOR');
INSERT INTO FARE VALUES (1003,'C',3000,'NOR');
INSERT INTO FARE VALUES (1004,'D',4000,'NOR');
INSERT INTO FARE VALUES (1005,'E',5000,'NOR');

-- Populate SEAT_RESERVATION table
INSERT INTO SEAT_RESERVATION VALUES (1001,1,'2023-09-20','1A','JUAN PEREZ','5534667890');
INSERT INTO SEAT_RESERVATION VALUES (1002,1,'2023-09-20','1B','MARIA LOPEZ','5555555555');
INSERT INTO SEAT_RESERVATION VALUES (1003,1,'2023-09-20','1C','JOSE GARCIA','5512334387');
INSERT INTO SEAT_RESERVATION VALUES (1004,1,'2023-09-20','1D','IVAN MENDOZA','5522317658');
INSERT INTO SEAT_RESERVATION VALUES (1005,1,'2023-09-20','2A','MARILU SANCHEZ','5544765789');

-- Select statements
SELECT * FROM AIRPORT;
SELECT * FROM FLIGHT;
SELECT * FROM FLIGHT_LEG_INSTANCE;
SELECT * FROM FARE;
SELECT * FROM SEAT_RESERVATION;
